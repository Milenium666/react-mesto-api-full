(this.webpackJsonpmesto=this.webpackJsonpmesto||[]).push([[0],{29:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(19),o=n.n(s),i=(n(29),n(24)),r=n(2),l=n(3),u=c.a.createContext(),d=n(20),p=n(21),j=new(function(){function e(t){var n=t.address;Object(d.a)(this,e),this._address=n}return Object(p.a)(e,[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430 ".concat(e.status))}},{key:"getUserData",value:function(){return fetch("".concat(this._address,"/users/me"),{credentials:"include",headers:{"Content-Type":"application/json"}}).then(this._checkResponse)}},{key:"getCards",value:function(){return fetch("".concat(this._address,"/cards"),{credentials:"include"}).then(this._checkResponse)}},{key:"editProfile",value:function(e){var t=e.name,n=e.about;return fetch("".concat(this._address,"/users/me"),{credentials:"include",method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then(this._checkResponse)}},{key:"addNewCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this._address,"/cards"),{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then(this._checkResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._address,"/cards/").concat(e),{credentials:"include",method:"DELETE"}).then(this._checkResponse)}},{key:"likeCardStatus",value:function(e,t){return fetch("".concat(this._address,"/cards/").concat(e,"/likes"),{credentials:"include",method:t?"PUT":"DELETE",headers:{"Content-Type":"application/json"}}).then(this._checkResponse)}},{key:"updateAvatar",value:function(e){var t=e.avatar;return fetch("".concat(this._address,"/users/me/avatar"),{credentials:"include",method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(this._checkResponse)}}]),e}())({address:"https://milenium666.nomoredomains.rocks"}),m="milenium666.nomoredomains.rocks",h=function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))},b=n.p+"static/media/logo.bbe2a6ea.svg",_=n(8),f=n(0);var O=function(e){var t=e.userData,n=e.loggedIn,a=e.onSignOut,s=c.a.useState(),o=Object(r.a)(s,2),i=o[0],l=o[1];return Object(f.jsxs)("header",{className:"header",children:[Object(f.jsx)("img",{className:"logo",alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f \u041c\u0435\u0441\u0442\u043e",src:b}),Object(f.jsxs)("div",{className:"header__links",children:[Object(f.jsx)("p",{className:"header__email ".concat(n?"":"header__email_hidden"),children:t.email}),Object(f.jsx)(_.b,{className:"header__link",onClick:function(){l(!i)},to:"".concat(n?"":i?"/signin":"/signup"),children:n?"":i?"\u0412\u0445\u043e\u0434":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(f.jsx)(_.b,{className:"header__link header__link_color-grey ".concat(!n&&"header__email_hidden"),to:"/",onClick:a,children:"\u0412\u044b\u0439\u0442\u0438"})]})]})};var v=function(e){var t=e.card,n=e.onCardClick,a=e.onCardLike,s=e.onCardDelete,o=c.a.useContext(u),i=t.owner._id===o._id,r="photo-grid__detete ".concat(i?"photo-grid__detete_visible":"photo-grid__detete_hidden"),l=t.likes.some((function(e){return e._id===o._id})),d="photo-grid__like ".concat(l&&"photo-grid__like_active");return Object(f.jsxs)("li",{className:"photo-grid__card",children:[Object(f.jsx)("img",{src:t.link,alt:t.name,onClick:function(){n(t)},className:"photo-grid__image"}),Object(f.jsx)("button",{className:r,onClick:function(){s(t)},type:"button"}),Object(f.jsxs)("div",{className:"photo-grid__discription",children:[Object(f.jsx)("p",{className:"photo-grid__place",children:t.name}),Object(f.jsxs)("div",{className:"photo-grid__likes",children:[Object(f.jsx)("button",{type:"button",className:d,onClick:function(){a(t)}}),Object(f.jsx)("p",{className:"photo-grid__like-count",children:t.likes.length})]})]})]})};var g=function(e){var t=e.onEditAvatar,n=e.onEditProfile,a=e.onAddPlace,s=e.onCardClick,o=e.cards,i=e.onCardLike,r=e.onCardDelete,l=c.a.useContext(u);return Object(f.jsxs)("main",{className:"content",children:[Object(f.jsx)("section",{className:"profile indent",children:Object(f.jsxs)("div",{className:"profile__container",children:[Object(f.jsxs)("div",{className:"profile__data",children:[Object(f.jsx)("div",{className:"profile__avatar",onClick:t,style:{backgroundImage:"url(".concat(l.avatar,")")}}),Object(f.jsxs)("div",{className:"profile__data profile-info",children:[Object(f.jsxs)("div",{className:"profile__data info",children:[Object(f.jsx)("h1",{className:"info__user-name",children:l.name}),Object(f.jsx)("button",{className:"info__button-pen",type:"button",onClick:n})]}),Object(f.jsx)("p",{className:"profile-info__occupation",children:l.about})]})]}),Object(f.jsx)("button",{className:"profile__button-plus",type:"button",onClick:a})]})}),Object(f.jsx)("section",{className:"elements indent",children:Object(f.jsx)("ul",{className:"photo-grid",children:o.map((function(e){return Object(f.jsx)(v,{card:e,onCardClick:s,onCardLike:i,onCardDelete:r},e._id)}))})})]})};var x=function(){return Object(f.jsx)("footer",{className:"footer indent",children:Object(f.jsx)("p",{className:"footer__copyright",children:"\xa9 2021 Mesto Russia"})})};var C=function(e){var t=e.card,n=e.onClose;return Object(f.jsx)("div",{className:t?"popup popup_opened":"popup popup_pic",id:"show-image",children:Object(f.jsxs)("div",{className:"popup__container",children:[Object(f.jsx)("button",{className:"popup__close popup__close_pic",type:"button",id:"close-show_image",onClick:n}),Object(f.jsx)("img",{src:null===t||void 0===t?void 0:t.link,alt:null===t||void 0===t?void 0:t.name,className:"popup__image"}),Object(f.jsx)("p",{className:"popup__description-place",children:null===t||void 0===t?void 0:t.name})]})})};var N=function(e){var t=e.name,n=e.title,a=e.nameButton,c=e.children,s=e.isOpen,o=e.size,i=e.onClose,r=e.onSubmit;return Object(f.jsx)("div",{className:s?"popup popup_opened":"popup",id:t,children:Object(f.jsx)("div",{className:"popup__container",children:Object(f.jsxs)("div",{className:"popup__content popup__content_".concat(o),children:[Object(f.jsx)("button",{className:"popup__close",type:"button",onClick:i}),Object(f.jsx)("h2",{className:"popup__edit",children:n}),Object(f.jsxs)("form",{className:"popup__data-container",id:t,onSubmit:r,type:"submit",children:[c,Object(f.jsx)("button",{type:"submit",className:"popup__button-save",children:a})]})]})})})};var k=function(e){var t=e.isOpen,n=e.onClose,a=e.onUpdateUser,s=c.a.useContext(u),o=c.a.useState(""),i=Object(r.a)(o,2),l=i[0],d=i[1],p=c.a.useState(""),j=Object(r.a)(p,2),m=j[0],h=j[1];return c.a.useEffect((function(){d(s.name),h(s.about)}),[s,t]),Object(f.jsxs)(N,{name:"profile-popup",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",nameButton:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({name:l,about:m}),d(),h()},children:[Object(f.jsx)("input",{type:"text",className:"popup__data popup__data_type_name",name:"name",id:"user-name",minLength:"2",maxLength:"40",placeholder:"\u0418\u043c\u044f \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",value:l||"",onChange:function(e){d(e.target.value)},required:!0}),Object(f.jsx)("span",{className:"error",id:"user-name-error"}),Object(f.jsx)("input",{type:"text",className:"popup__data popup__data_type_job",name:"job",id:"job",minLength:"2",maxLength:"200",placeholder:"\u0420\u043e\u0434 \u0414\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438",value:m||"",onChange:function(e){h(e.target.value)},required:!0}),Object(f.jsx)("span",{className:"error",id:"job-error"})]})};var y=function(e){var t=e.isOpen,n=e.onClose,a=e.onUpdateAvatar,s=c.a.useRef();return Object(f.jsxs)(N,{name:"edit-img-user",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0410\u0432\u0430\u0442\u0430\u0440",nameButton:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",size:"size_m",isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({avatar:s.current.value})},children:[Object(f.jsx)("input",{type:"url",className:"popup__data popup__data_margin",name:"url_img_user",id:"edit-img-src",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",ref:s,required:!0}),Object(f.jsx)("span",{className:"error",id:"edit-img-src-error"})]})};var S=function(e){var t=e.isOpen,n=e.onClose,a=e.onAddPlace,s=c.a.useState(""),o=Object(r.a)(s,2),i=o[0],l=o[1],u=c.a.useState(""),d=Object(r.a)(u,2),p=d[0],j=d[1];return Object(f.jsxs)(N,{name:"add-place",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",nameButton:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({name:i,link:p}),l(""),j("")},children:[Object(f.jsx)("input",{type:"text",className:"popup__data popup__data_type_name-place",name:"name",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",id:"place-name",minLength:"2",maxLength:"30",value:i,onChange:function(e){l(e.target.value)},required:!0}),Object(f.jsx)("span",{className:"error",id:"place-name-error"}),Object(f.jsx)("input",{type:"url",className:"popup__data popup__data_type_pic-link",name:"link",id:"pic-link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",value:p,onChange:function(e){j(e.target.value)},required:!0}),Object(f.jsx)("span",{className:"error",id:"pic-link-error"})]})},w=n(11),T=n(10);var P=function(e){var t=e.title,n=e.buttonText,a=e.children,c=e.onSubmit,s=e.onChange;return Object(f.jsx)("section",{className:"register indent",children:Object(f.jsx)("div",{className:"register__container",children:Object(f.jsxs)("form",{className:"register__form",onSubmit:c,children:[Object(f.jsx)("h1",{className:"register__title",children:t}),Object(f.jsx)("input",{placeholder:"Email",className:"register__input",type:"email",name:"email",required:!0,onChange:s,autoComplete:"email"}),Object(f.jsx)("input",{placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",className:"register__input",type:"password",name:"password",required:!0,onChange:s,autoComplete:"current-password"}),Object(f.jsx)("button",{className:"register__button-save",children:n}),a]})})})};var E=function(e){var t=e.onRegister,n=c.a.useState({email:"",password:""}),a=Object(r.a)(n,2),s=a[0],o=a[1];return Object(f.jsx)(P,{title:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",buttonText:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f",onSubmit:function(e){e.preventDefault();var n=s.email,a=s.password;t({email:n,password:a})},onChange:function(e){var t=e.target,n=t.name,a=t.value;o(Object(T.a)(Object(T.a)({},s),{},Object(w.a)({},n,a)))},children:Object(f.jsxs)("div",{className:"register__login",children:[Object(f.jsx)("p",{className:"register__subtitle",children:"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"}),Object(f.jsx)(_.b,{className:"register__link",to:"signin",children:"\u0412\u043e\u0439\u0442\u0438"})]})})};var A=function(e){var t=e.onLogin,n=c.a.useState({email:"",password:""}),a=Object(r.a)(n,2),s=a[0],o=a[1];return Object(f.jsx)(P,{title:"\u0412\u0445\u043e\u0434",buttonText:"\u0412\u043e\u0439\u0442\u0438",onSubmit:function(e){if(e.preventDefault(),s.email&&s.password){var n=s.email,a=s.password;t(n,a)}},onChange:function(e){var t=e.target,n=t.name,a=t.value;o(Object(T.a)(Object(T.a)({},s),{},Object(w.a)({},n,a)))}})};var D=function(e){var t=e.img,n=e.subTitle,a=e.isOpen,c=e.onClose;return Object(f.jsx)("div",{className:a?"popup popup_opened":"popup",children:Object(f.jsx)("div",{className:"popup__container",children:Object(f.jsxs)("div",{className:"popup__content",children:[Object(f.jsx)("button",{className:"popup__close",type:"button",onClick:c}),Object(f.jsx)("div",{className:"".concat(t)}),Object(f.jsx)("p",{className:"popup__subtitle",children:n})]})})})},L=n(23),R=["component"],I=function(e){var t=e.component,n=Object(L.a)(e,R);return Object(f.jsx)(l.b,{children:function(){return!0===n.loggedIn?Object(f.jsx)(t,Object(T.a)({},n)):Object(f.jsx)(l.a,{to:"/signin"})}})};var U=function(){var e=c.a.useState(!1),t=Object(r.a)(e,2),n=t[0],a=t[1],s=c.a.useState(!1),o=Object(r.a)(s,2),d=o[0],p=o[1],b=c.a.useState(!1),_=Object(r.a)(b,2),v=_[0],N=_[1],w=c.a.useState(null),T=Object(r.a)(w,2),P=T[0],L=T[1],R=c.a.useState({}),U=Object(r.a)(R,2),q=U[0],B=U[1],J=c.a.useState([]),z=Object(r.a)(J,2),F=z[0],H=z[1],M=c.a.useState(!1),G=Object(r.a)(M,2),K=G[0],Q=G[1],V=c.a.useState({email:"",id:""}),W=Object(r.a)(V,2),X=W[0],Y=W[1],Z=Object(l.g)(),$=c.a.useState(),ee=Object(r.a)($,2),te=ee[0],ne=ee[1],ae=c.a.useState(!1),ce=Object(r.a)(ae,2),se=ce[0],oe=ce[1];c.a.useEffect((function(){ue()}),[]),c.a.useEffect((function(){j.getUserData().then((function(e){B(e)})).catch((function(e){return console.log(e)}))}),[]),c.a.useEffect((function(){j.getCards().then((function(e){H(e.map((function(e){return{name:e.name,link:e.link,_id:e._id,owner:e.owner,likes:e.likes}})))})).catch((function(e){return console.log(e)}))}),[]);var ie=function(){oe(!0)},re=function(){a(!1),p(!1),N(!1),L(null),oe(!1)},le=function(){ne(!1),ie()},ue=function(){var e,t=localStorage.getItem("jwt");t&&(e=t,fetch("".concat(m,"/users/me"),{credentials:"include",method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then(h)).then((function(e){var t=e.data,n=t.email,a=t._id;Y({email:n,_id:a}),Q(!0),Z.push("/")})).catch((function(e){return console.log(e)}))};return Object(f.jsx)(u.Provider,{value:q,children:Object(f.jsxs)("div",{children:[Object(f.jsx)(O,{userData:X,loggedIn:K,onSignOut:function(){localStorage.removeItem("jwt"),Q(!1),Z.push("/signin")}}),Object(f.jsxs)(l.d,{children:[Object(f.jsx)(l.b,{exact:!0,path:"/signup",children:Object(f.jsx)(E,{onRegister:function(e){var t=e.email,n=e.password;console.log(t,n),function(e){var t=e.password,n=e.email;return fetch("".concat(m,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:t,email:n})}).then(h)}({email:t,password:n}).then((function(){ne(!0),ie()})).catch(le)}})}),Object(f.jsx)(l.b,{exact:!0,path:"/signin",children:Object(f.jsx)(A,{onLogin:function(e,t){(function(e){var t=e.email,n=e.password;return fetch("".concat(m,"/signin"),{credentials:"include",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})}).then(h)})(e).then((function(e){var t=e.token;localStorage.setItem("jwt",t),Q(!0),Z.push("/")})).catch(le)}})}),Object(f.jsx)(I,{exact:!0,path:"/",loggedIn:K,component:g,onEditAvatar:function(){a(!0)},onEditProfile:function(){p(!0)},onAddPlace:function(){N(!0)},onCardClick:function(e){L(e)},cards:F,onCardLike:function(e){var t=e.likes.some((function(e){return e._id===q._id}));j.likeCardStatus(e._id,!t).then((function(t){H((function(n){return n.map((function(n){return n._id===e._id?t:n}))}))})).catch((function(e){return console.log(e)}))},onCardDelete:function(e){j.deleteCard(e._id).then((function(){H(F.filter((function(t){return t._id!==e._id})))})).catch((function(e){return console.log(e)}))}})]}),Object(f.jsx)(x,{}),Object(f.jsx)(y,{isOpen:n,onClose:re,onUpdateAvatar:function(e){var t=e.avatar;j.updateAvatar({avatar:t}).then((function(e){B(e),re()})).catch((function(e){return console.log(e)}))}}),Object(f.jsx)(k,{isOpen:d,onClose:re,onUpdateUser:function(e){var t=e.name,n=e.about;j.editProfile({name:t,about:n}).then((function(e){B(e),re()})).catch((function(e){return console.log(e)}))}}),Object(f.jsx)(S,{isOpen:v,onClose:re,onAddPlace:function(e){var t=e.name,n=e.link;j.addNewCard({name:t,link:n}).then((function(e){H([e].concat(Object(i.a)(F))),re()})).catch((function(e){return console.log(e)}))}}),Object(f.jsx)(C,{card:P,onClose:re}),Object(f.jsx)(D,{img:te?"popup__approved":"popup__false",subTitle:te?"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!":"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.",isOpen:se,onClose:function(){re(),te&&Z.push("/signin")}})]})})},q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,40)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),s(e),o(e)}))};o.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(_.a,{children:Object(f.jsx)(U,{})})}),document.getElementById("root")),q()}},[[39,1,2]]]);
//# sourceMappingURL=main.8b25b6bb.chunk.js.map